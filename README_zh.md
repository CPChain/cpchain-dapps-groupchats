# CPChain 群聊天

群聊天功能为 CPChain 基金会完全基于 CPChain 主链开发。用户可通过群聊天在 CPChain 主链上自发形成社区。所有消息均通过对称密钥进行加密，最大限度保障信息安全。

群分为公开群和私有群两种。

公开群：群主创建AES 密钥，使用自己在 Identity 上的私钥进行加密，创建群（群名称、使用JSON 序列化的相关信息，加密后的 AES 密钥）；用户需要加入群时，获取该群群主的公钥，用公钥解密 AES 密钥，使用 AES 密钥加密消息。用户调用加入群方法（Join，指定群名称），即可加入群。发出的事件包括块号。

私有群：群主创建群时不设置 AES 密钥，自行去拉取其他人，直接通过加密聊天发送”入群邀请“消息，消息包含群ID、AES 密钥等信息，接收邀请时需调用群聊天 Join 合约。

## 用户用例

群主：

## 流程分析

整体包含三个流程：

+ 创建群
+ 加入群
+ 发送聊天消息

## 部署

合约地址: 0x262Fced17e07FaE9e5750653bc6FF5882AF9953E

## 创建 AES 密钥

对于公开群来说，群主需要创建一个 AES 密钥（AES-256，32字节密钥，base64编码），然后使用加密聊天的私钥对其进行签名（ECDSA，签名结果也是 base64编码），将签名及密钥序列化到一个 JSON 中，然后存入合约中。如下：

```json

{
    "key": "",
    "sig": ""
}

```
